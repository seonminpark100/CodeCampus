package com.lms.springboot.prof;

import java.util.ArrayList;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import com.lms.springboot.utils.PagingUtil;

import jakarta.servlet.http.HttpServletRequest;

@Controller
public class ProfController
{
	@Autowired
	IProfService dao;
	
//	Lecture main page
	@GetMapping("/prof/submain.do")
	public String profSubMain(HttpServletRequest req, Model model) {
		String lectureCode = req.getParameter("lectureCode");
		model.addAttribute("lectureCode" , lectureCode);
		
		dao.getStudentTotalCount(profDTO);
		
		return "prof/submain";
	}
	
//	Students List
	@GetMapping("/prof/studentList.do")
	public String studentList(HttpServletRequest req, Model model, ProfDTO profDTO) {
		String lectureCode = req.getParameter("lectureCode");
		profDTO.setLecture_code(lectureCode);
		
		int totalCount = dao.getStudentTotalCount(profDTO);
		int pageSize = 10; 
		int blockPage = 5; 
		int pageNum = (req.getParameter("pageNum")==null 
			|| req.getParameter("pageNum").equals("")) 
			? 1 : Integer.parseInt(req.getParameter("pageNum"));
		
		PagingUtil.paging(req, profDTO, model, totalCount, pageSize, blockPage, pageNum);
		
		// Saved DB dates at Model Object
		ArrayList<ProfDTO> lists = dao.studentBoardListPage(profDTO);
		model.addAttribute("lists", lists);
		model.addAttribute("lectureCode", lectureCode);
		// Page Number Stuff
		String pagingImg =
			PagingUtil.pagingImg(totalCount, pageSize, 
				blockPage, pageNum,
				req.getContextPath()+"/prof/studentList.do?lectureCode="+lectureCode+"&");
		model.addAttribute("pagingImg", pagingImg);
		
		return "prof/studentBoard/studentList";
	}

	@RequestMapping("/prof/mypage.do")
	public String mypage() {
		return "prof/mypage";
	}

}
