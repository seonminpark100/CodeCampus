<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lms.springboot.jdbc.IUserService">
	<select id="selectAllLecture" resultType="com.lms.springboot.jdbc.UserDTO">
		SELECT 
			lecture_idx,
			lecture_name,
			prof_id,
			lecture_start_date,
			lecture_end_date,
			lecture_code,
			u.major_id,
			u.user_name
			
		FROM lecture l, user_info u
		WHERE l.prof_id = u.user_id
	</select>
	
	<select id="selectAllMyLecture" resultType="com.lms.springboot.jdbc.UserDTO"
		parameterType="String">
		SELECT 
			lecture_idx,
			lecture_name,
			prof_id,
			lecture_start_date,
			lecture_end_date,
			l.lecture_code,
			u.major_id,
			u.user_name
		FROM lecture l, user_info u,
        (SELECT lecture_code, u.user_id, u.user_name 
          FROM enroll e, user_info u
          WHERE e.user_id = u.user_id
          ) s
		WHERE l.prof_id = u.user_id
         AND l.lecture_code = s.lecture_code
         AND s.user_id = #{ user_id }
	</select>
	
	<select id="selectOneLecture" resultType="com.lms.springboot.jdbc.UserDTO"
		parameterType="String">
		SELECT 
			lecture_idx,
			lecture_name,
			prof_id,
			lecture_start_date,
			lecture_end_date,
			lecture_code,
			u.major_id,
			u.user_name
		FROM lecture l, user_info u
		WHERE l.prof_id = u.user_id AND lecture_code=#{lecture_code}
	</select>
	
<!-- 	<select id="validateUser" resultType="int" -->
<!-- 		parameterType="com.lms.springboot.jdbc.UserDTO"> -->
<!-- 		SELECT COUNT(*) FROM enroll WHERE user_id=#{ user_id } AND lecture_code=#{ lecture_code }  -->
<!-- 	</select> -->
	
<!-- 	유저 -->
	<select id="selectAllUser" resultType="com.lms.springboot.jdbc.UserDTO"
		parameterType="String">
		SELECT * FROM user_info
	</select>
	
	<select id="selectOneUser" resultType="com.lms.springboot.jdbc.UserDTO"
		parameterType="String">
		SELECT * FROM user_info WHERE user_id=#{ user_id }
	</select>
		
	<update id="updateUser" parameterType="com.lms.springboot.jdbc.UserDTO">
		UPDATE user_info
		 SET
		  user_name = #{ user_name }
		WHERE user_id = #{ user_id }
	</update>
	
<!-- 	강의세션 -->
	<select id="selectLectureSessionList" resultType="com.lms.springboot.jdbc.UserDTO"
		parameterType="String">
		SELECT * FROM boards 
		 WHERE category='L' AND lecture_code=#{ lecture_code }
	</select>

	<select id="selectOneBoard" parameterType="com.lms.springboot.jdbc.UserDTO"
		resultType="com.lms.springboot.jdbc.UserDTO">
		SELECT * FROM boards
		 WHERE category=#{ category } AND board_idx=#{ board_idx }
	</select>
</mapper>