<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
                          "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lms.springboot.jdbc.QnaboardDAO">

    <select id="getTotalQnaCount" parameterType="com.lms.springboot.jdbc.ParameterDTO3" resultType="int">
        SELECT COUNT(*) FROM BOARDS
        WHERE CATEGORY = 'Q'
        <if test="search_Field != null and search_Keyword != null and search_Keyword != ''">
            <choose>
                <when test="search_Field == 'BOARD_TITLE'">
                    AND BOARD_TITLE LIKE '%' || #{search_Keyword} || '%'
                </when>
                <when test="search_Field == 'board_content'">
                    AND BOARD_CONTENT LIKE '%' || #{search_Keyword} || '%'
                </when>
                <when test="search_Field == 'USER_ID'">
                    AND USER_ID LIKE '%' || #{search_Keyword} || '%'
                </when>
            </choose>
        </if>
        <if test="lecture_Code != null and lecture_Code != ''">
            AND LECTURE_CODE = #{lecture_Code}
        </if>
    </select>

    <select id="listQnaPage" parameterType="com.lms.springboot.jdbc.ParameterDTO3" resultType="com.lms.springboot.jdbc.QnaboardDTO">
        SELECT * FROM (
            SELECT T.*, ROWNUM RNUM FROM (
                SELECT BOARD_IDX, USER_ID, LECTURE_CODE, BOARD_TITLE, BOARD_CONTENT, BOARD_POSTDATE, VISITCOUNT, CATEGORY,
                       BGROUP, BSTEP, BINDENT, BOARD_LIKE
                FROM BOARDS
                WHERE CATEGORY = 'Q'
                <if test="search_Field != null and search_Keyword != null and search_Keyword != ''">
                    <choose>
                        <when test="search_Field == 'BOARD_TITLE'">
                            AND BOARD_TITLE LIKE '%' || #{search_Keyword} || '%'
                        </when>
                        <when test="search_Field == 'board_content'">
                            AND BOARD_CONTENT LIKE '%' || #{search_Keyword} || '%'
                        </when>
                        <when test="search_Field == 'USER_ID'">
                            AND USER_ID LIKE '%' || #{search_Keyword} || '%'
                        </when>
                    </choose>
                </if>
                <if test="lecture_Code != null and lecture_Code != ''">
                    AND LECTURE_CODE = #{lecture_Code}
                </if>
                ORDER BY BGROUP DESC, BSTEP ASC
            ) T
        ) WHERE RNUM BETWEEN #{start} AND #{end}
    </select>

    </mapper>